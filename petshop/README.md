# WbSchool_DB



# Работа с магазином

### Добавление нового товара 
```sql
SELECT  petshop.good_upd('{
"name": "Кот Сфинкс",
"good_type_id":  1,
"description": "Сфинкс – бесшерстная порода кошек небольшого размера с бархатной кожей. Вес - 5 кг, рост - 50 см.",
"selling_price":  35000
    }'::jsonb, _staff_id := 2);
```

Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```
### Редактирование данных по существующему товару (по nm_id)
```sql
SELECT  petshop.good_upd('{
"nm_id": 2,
"name": "Кот Сфинкс",
"good_type_id":  1,
"description": "Сфинкс – бесшерстная порода кошек небольшого размера с бархатной кожей. Вес - 5 кг, рост - 50 см.",
"selling_price":  55000
    }'::jsonb, _staff_id := 2);
```

Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Получить инфо о товарах (по nm_id, типу товара, минимальной цене, максимальной цене)

```sql
select petshop.goods_get_by_param(_nm_id := null, _good_type_id := null, _min_selling_price := 100 , _max_selling_price := 35000)
```
Пример ответа при правильном выполнении:
```jsonb
{"data": [{"dt": "2023-10-15T17:28:48.036389+00:00", "name": "Попугай Жако", "nm_id": 1, "shop_id": 2, "description": " Жако попугай птица. В мире животных пернатых интеллектуалов представляет попугай жако. Ученые давно раскрыли удивительный талант птицы к обучению, мощную энергетику, заряжающую радостью всех вокруг. Словарный запас в тысячи слов позволяет вести диалоги с человеком. Жако не просто повторяет фразы, а использует их уместно речевой ситуации. Мир попугая интересен и богат. Описание и особенности Жако — это тупохвостый попугай. Второе название – африканский серый. Внешность птицы не поражает яркостью красок, но привлекает гармоничностью наряда. Серый окрас оперения стального оттенка. Выделяют редкую разновидность сородичей пурпурно-красного цвета. Издали оперение похоже на змеиную чешую. Частые некрупные перья бархатистой структуры приятны на ощупь. Ноги темнее, свинцового оттенка, покрыты маленькими чешуйками. ", "good_type_id": 4, "selling_price": 4500.00, "quantity_at_storage": 92}, {"dt": "2023-10-15T17:28:48.159416+00:00", "name": "Кот Сфинкс", "nm_id": 2, "shop_id": null, "description": "Сфинкс – бесшерстная порода кошек небольшого размера с бархатной кожей, на ощупь похожей на шкуру персика.", "good_type_id": 1, "selling_price": 35000.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:48.294171+00:00", "name": "Кот экзот", "nm_id": 3, "shop_id": null, "description": "Экзотическая кошка – это короткошерстная разновидность персидской породы. Стандарты этих пород идентичны во всем за исключением длины шерсти. У экзотов такой же мягкий характер, они ласковы и достаточно активны. Это спокойные кошки прекрасно ладят другими домашними животными и детьми. Их голос очень тихий и нежный. Шерсти, в отличие от персов, практически не требуется уход.", "good_type_id": 1, "selling_price": 8200.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:48.400266+00:00", "name": "Собака Бигль", "nm_id": 4, "shop_id": null, "description": "Бигль – средней высоты порода, с мускулистым торсом и вытянутой мордочкой. Вес варьируется от 8 до 19 кг. рост от 32 до 41 см. Уши длинные, висячие Глаза среднего размера, темного цвета, по многим отзывам придают умный вид собаке. Хвост длинный, прямой. Шерсть короткая, основной цвет белый, по бокам черные пятна и коричневый окрас на мордочке, лапах, ушах. Характер. Порода биргль – это эмоционально спокойная собака, добрая и любящая свою семью.", "good_type_id": 5, "selling_price": 9900.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:48.668822+00:00", "name": "Терьер", "nm_id": 6, "shop_id": null, "description": "Рост: 66-78 см. Вес: 45-60 кг. Страна: Россия. Шерсть: удлиненная. Эту породу собак, являющихся крупными терьерами, вывели отечественные селекционеры из известного питомника «Красная звезда». Очень часто они «служат» в полиции, а также на таможне. Из них получаются отличные ищейки. ", "good_type_id": 5, "selling_price": 30000.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:48.807986+00:00", "name": "Ушастый ёж", "nm_id": 7, "shop_id": null, "description": "Ушастый ёж (Hemiechinus auritus). Мелкий еж с мягким коротким мехом. Длина тела 14-23 см. Ухо длиннее половины головы. Колючий панцирь не закрывает бока тела. Поверхность игл покрыта продольными бороздами. Окраска меха и колючего панциря изменчива. Северные формы окрашены темнее с интенсивным рыжеватым оттенком, южные - очень светлые с тусклым палево-рыжеватым оттенком. Типичный обитатель глинистых и песчанных степей, полупустынь и пустынь.", "good_type_id": 8, "selling_price": 1500.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:48.967602+00:00", "name": "Черепаха", "nm_id": 8, "shop_id": null, "description": "Страна: Россия.", "good_type_id": 6, "selling_price": 2000.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:49.095146+00:00", "name": "Хомяк", "nm_id": 9, "shop_id": null, "description": "Рост: 10 см. Вес: 2 кг. Страна: Россия.", "good_type_id": 9, "selling_price": 2000.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:49.253843+00:00", "name": "Ошейник для собак", "nm_id": 10, "shop_id": null, "description": "Ошейник для собак цепь двухрядная с цугом 40/2 мм", "good_type_id": 14, "selling_price": 1000.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:49.406163+00:00", "name": "Сухой корм для собак Авва ягненок с рисом (для мелких пород)", "nm_id": 11, "shop_id": null, "description": "Бренд Авва Тип корма сухой Вкус ягненок, ягненок с рисом Возраст животного взрослые (1-6 лет), Для взрослых Размер породы мелкие породы Основной ингредиент мясо Гарнир злаки Минеральные вещества железо 50 мгр, йод 1,5 мгр, медь 5 мгр, марганец 35 мгр, цинк 65 мгр, таурин 100 мгр Витамины A, D3, E Класс ингредиентов премиум Состав дегидратированное мясо ягненка (17%), рис (14%), кукуруза, обработанные ядра ячменя, горох, животные жиры, рыбная мука, свекловичный жом, льняное семя, мука из плодов рожкового дерева, минералы, лососевый жир, пивные дрожжи, лецитин, яичный порошок, L-Карнитин, таурин", "good_type_id": 10, "selling_price": 350.00, "quantity_at_storage": null}, {"dt": "2023-10-15T17:28:49.550153+00:00", "name": "Корма для с/х птиц Purina", "nm_id": 12, "shop_id": null, "description": "urina комбикорм для бройлеров Стартер Purina X-PRO 10кг. 9 октября. Хит. 1 677 ₽2 500 ₽. −33%. Комбикорм для продуктивных перепелов Purina 25 кг.", "good_type_id": 11, "selling_price": 800.00, "quantity_at_storage": null}]}
```

### Получить инфо о всех магазинах (либо по shop_id)

```sql
select petshop.shops_get_by_param(_shop_id := null)
```
Пример ответа при правильном выполнении:
```jsonb
{"data": [{"phone": "7491261522", "address": "Рязань, Ленинского Комсомола, д.12", "shop_id": 1}, {"phone": "7491261533", "address": "Рязань, Пушкина, д.1", "shop_id": 2}, {"phone": "7491271522", "address": "Рязань, Есенина, д.4", "shop_id": 3}]}
```


### Получить инфо о всех магазинах (либо по shop_id)

```sql
select petshop.shops_get_by_param(_shop_id := 1)
```
Пример ответа при правильном выполнении:
```jsonb
{"data": [{"phone": "7491261522", "address": "Рязань, Ленинского Комсомола, д.12", "shop_id": 1}]}
```

### Обновить количество товара в конкретном магазине
```sql
select petshop.storage_upd('{
    "shop_id": 2,
    "nm_id": 1,
    "quantity": 10
}', _staff_id := 5)
```

Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```